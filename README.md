# Markov Chain Game

マルコフ連鎖の概念を体験できる、高校生向けのインタラクティブなウェブゲームです。プレイヤーはグラフのエッジの重みを操作し、マルコフ過程の定常状態（固有ベクトル）に基づいてスコアを競います。

## 概要

このゲームは、プレイヤーがグラフの構造に影響を与え、その結果として生じるマルコフ連鎖の定常状態を操作することを目指します。各ターンでプレイヤーは限られたポイントを消費してエッジの重みを変更し、最終的なスコアは定常状態におけるプレイヤーノードの成分によって決定されます。

## 機能

- **ルーム管理**: 既存のゲームルームに参加するか、新しいルームを作成できます。
- **カスタマイズ可能なルーム設定**: 新規ルーム作成時に、プレイヤー数、非プレイヤーノード数、ラウンドごとのポイント、最大ターン数を設定できます。
- **リアルタイムなゲーム進行**: WebSocketを通じて、他のプレイヤーの動きやスコア計算の更新がリアルタイムで反映されます。
- **インタラクティブなグラフ表示**: 現在のグラフの状態（ノードとエッジ、重み）を視覚的に表示します。頂点位置はドラッグで自由に配置できます．
- **スコア計算とランキング**: 各ターンの終了時にマルコフ連鎖の定常状態を計算し、プレイヤーのスコアを更新します。ゲーム終了時には最終ランキングが表示されます。

## ゲームルール

- **プレイヤー数**: N人で対戦します。
- **初期盤面**: N個のプレイヤーノードとM個の非プレイヤーノードが、対称的に適当に連結された重み付きグラフが初期盤面となります。
- **ラウンドの進行**: 各ラウンドで、それぞれのプレイヤーには K ポイントが割り振られます。
- **ムーブの提出**: プレイヤーは、Kポイント分の「ムーブ」を他のプレイヤーに伏せて提出します。1ポイントにつき，選んだ辺の重みを1増やすか減らすことができます．ポイントを使い切るまで，複数の辺の重みを変更できます．
- **盤面への反映**: 全てのプレイヤーがムーブを提出した後、それらが盤面に反映されます。
- **スコア計算**: 盤面である重み付きグラフの、固有値1の固有ベクトル（マルコフ過程の定常状態）を計算します。固有ベクトルのプレイヤーノードの成分がそのプレイヤーの得点になります。(解の一意性を保証するために、全ての辺の重みに小さな正の値を加えます。)
- **ターン**: 上記のプロセスを S ターン繰り返します。
- **ゲーム終了**: ゲーム終了時に、得点の高い順にランキングが表示されます。


## 技術スタック

- **フロントエンド**: React (JavaScript)
  - グラフ描画: `vis-network`
- **バックエンド**: Python (FastAPI)
  - マルコフ連鎖計算: `numpy`, `scipy`
- **データベース**: (現時点ではインメモリまたは簡易的なファイルベース)
- **リアルタイム通信**: WebSocket

## セットアップとローカル実行

このプロジェクトをローカル環境でセットアップし、実行するための手順です。

### 前提条件

- Node.js (npm)
- Python 3.9+
- pip (Pythonのパッケージインストーラ)

### 1. リポジトリのクローン

```bash
git clone https://github.com/shizuo-kaji/markov-game.git
cd markov-game

### 2. バックエンドのセットアップと起動

```bash
cd backend
python3 -m venv venv
source venv/bin/activate  # Windows: .\venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload
```

バックエンドは `http://localhost:8000` で起動します。

### 3. フロントエンドのセットアップと起動

新しいターミナルを開き、プロジェクトのルートディレクトリに戻ってから実行します。

```bash
cd ../frontend
npm install
npm start
```

フロントエンドは `http://localhost:3000` で起動します。

### 4. ブラウザで開く

ブラウザで以下のURLを開いてゲームを開始します。

```
http://localhost:3000/
```

## AWS デプロイ

このプロジェクトは、AWS CloudShell を使用して簡単に AWS にデプロイできます。デプロイスクリプトは、フロントエンドを Amazon S3 + CloudFront に、バックエンドを AWS Elastic Beanstalk にデプロイします。

### 前提条件

- AWS CloudShell 環境

### デプロイ手順

1.  **CloudShell を起動**し、プロジェクトのルートディレクトリに移動します。
2.  以下のコマンドでデプロイスクリプトに実行権限を付与します。
    ```bash
    chmod +x deploy_aws.sh
    ```
3.  スクリプトを実行します。
    ```bash
    ./deploy_aws.sh
    ```

スクリプトは、デプロイの進行状況を表示し、完了後にフロントエンドとバックエンドのURLを出力します。デプロイには数分から十数分かかる場合があります。
